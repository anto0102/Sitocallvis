<script>
  // âœ… TMDB API Key - INSERISCI LA TUA QUI:
  const apiKey = "2d082597ab951b3a9596ca23e71413a8";

  const consigliatiContainer = document.getElementById("consigliati");

  async function fetchRandomPopularMovies() {
    let allMovies = [];

    // Carica da 3 pagine casuali
    for (let i = 0; i < 3; i++) {
      const page = Math.floor(Math.random() * 20) + 1;
      try {
        const res = await fetch(`https://api.themoviedb.org/3/movie/popular?api_key=${apiKey}&language=it-IT&page=${page}`);
        const data = await res.json();
        if (data.results) {
          allMovies = allMovies.concat(data.results);
        }
      } catch (error) {
        console.error("Errore nel caricamento film:", error);
      }
    }

    // Mischia i film
    const shuffled = allMovies.sort(() => 0.5 - Math.random());
    const selected = shuffled.slice(0, 10); // Mostra 10 film casuali

    consigliatiContainer.innerHTML = "";

    selected.forEach((movie) => {
      const title = movie.title || "Senza titolo";
      const poster = movie.poster_path
        ? `https://image.tmdb.org/t/p/w500${movie.poster_path}`
        : "fallback.jpg";

      const card = document.createElement("div");
      card.className = "movie-card";
      card.innerHTML = `
        <a href="dettagli.html?id=${movie.id}">
          <img src="${poster}" alt="${title}" />
          <h3>${title}</h3>
        </a>
      `;
      consigliatiContainer.appendChild(card);
    });
  }

  fetchRandomPopularMovies();
</script>
