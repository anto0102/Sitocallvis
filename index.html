<script>
  async function carica(tipo) {
    const lista = document.getElementById('lista');
    lista.innerHTML = 'Caricamentoâ€¦';

    try {
      const res = await fetch(`/api/proxy?url=${encodeURIComponent(`https://vixsrc.to/api/list/${tipo}?lang=it`)}`);
      const data = await res.json();

      lista.innerHTML = '';
      data.results.forEach(item => {
        const div = document.createElement('div');
        div.innerHTML = `
          <img src="${item.poster}" width="100"><br>
          ${item.title}<br>
          <button onclick="showPlayer(${item.id}, '${tipo}')">Guarda</button>
        `;
        lista.appendChild(div);
      });
    } catch (e) {
      lista.innerText = 'Errore nel caricamento';
      console.error(e);
    }
  }

  function showPlayer(tmdbId, tipo) {
    const params = 'lang=it&autoplay=false&primaryColor=B20710';
    const url = tipo === 'movie'
      ? `https://vixsrc.to/movie/${tmdbId}?${params}`
      : `https://vixsrc.to/tv/${tmdbId}/1/1?${params}`;
    
    document.getElementById('player').innerHTML =
      `<iframe src="${url}" width="640" height="360" frameborder="0" allowfullscreen></iframe>`;
  }
</script>
